
pool: 
  name: Default
  demands:
    - agent.name -equals $(AGENT_NAME)

steps:
- task: CmdLine@2
  inputs:
     targetType: 'inline'
     script: '"C:\Program Files\R\R-4.0.3\bin\R.exe" -e  ''devtools::load_all(); options("testthat.output_file" = "test-results.xml"); devtools::test(reporter = JunitReporter$new());'''
     workingDirectory: $(PACKAGE_PATH)
     failOnStderr: true

- task: PublishTestResults@2
  inputs:
    testResultsFormat: 'JUnit'
    testResultsFiles: '**/test-*.xml'
    searchFolder: $(PACKAGE_PATH)
    testRunTitle: 'non-CI testhat plan'
    buildPlatform: 'x86_64-w64-mingw32/x64'
    buildConfiguration: 'R4.0.3'
